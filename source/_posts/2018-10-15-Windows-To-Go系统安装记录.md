---
title: Windows To Go系统安装记录
date: 2018-10-15 20:23:06
updated:
tags: [windows,wtg,折腾]
description:
keywords:
comments:
image:
categories:
  - 教程
---

本文记录了我安装WTG系统的坑与过程,使用的WTG辅助工具,~~写本文时还没体验系统~~,目前使用了U盘和机械硬盘.
到目前为止这个文章记录的WTG系统是可以日常使用的状态,做了基本的优化,之后我会继续按照使用更新.

**本文仅针对win电脑.**
**如果你是一个小白而且不想看大段文字只是想体验下WTG,那么和 [我的环境](#jump06) 保持一致,然后严格按照我的[操作步骤](#jump0)就好**
<!--more-->

# 某些重要的修改日志
*之前文章出现的错误或之后进行优化的步骤,在此记录*

> 20181022 不再建议使用1703版本制作WTG
> 20181022第一次WTG开机后注意将自动更新关闭或者修改注册表[开启更新](#jump5),否则可能导致无限重启

# Windows To GO(WTG)介绍
 官方介绍是啥自己去百度,我的理解WTG系统就是一个超级完整能够日用的PE系统.

# 移动设备
经费不多,移动硬盘体积太大,并非重度用户只是体验系统,所以我选择了`cz73 64g`版本,此时价格89RMB,实际容量58G.4k读写上稍微低于WTG最低性能要求.不过应该还是可以用.
闪迪没有量产工具,所以装机有很多问题,这些问题我之后会说到.
之后使用了机械硬盘,~~目前为止机械硬盘我还没有体验~~.

+ WTG制作,移动设备比较看重4K性能.
+ 使用辅助工具可以在大多数存储设备上制作WTG系统,所以你在用来换盆的手机上做也可以,不过肯定会卡的怀疑人生
+ 建议存储空间至少大于16G,不过我看到有个老哥用8GU盘也做了一个,没有屏蔽本地磁盘,还欢快的打着LOL



# <span id="jump1">需要知道的WTG辅助工具高级选项(必读)</span>

+ 本教程全程使用的WTG辅助工具,官方工具没有使用,Dism++制作并手动添加引导也一直失败,具体问题我也没去研究
+ **制作后会格式化移动设备的所有分区,做好备份**
+ 常用中,`传统`模式只能用于识别为本地磁盘的设备,`VHD&VHDX`只能制作Win8以上的系统,且得使用win7以上的系统环境写入.
+ `传统模式`可能会无法安装一些较大的软件
+ 选中固定大小会提高系统的效率,但是虚拟硬盘中的空闲空间就不能使用了.
+ 只有传统模式可以不重新分区,但是我建议小白都勾选上`重新分区`,避免莫名其妙的问题.
+ 只有传统模式下可以使用`Bitlocker`,它可以保护WTG文件系统在其他系统中不损坏,你只要不去刻意修改WTG系统文件通常是不会坏的的,但是可能会和还原软件冲突.
+ 禁用UASP会略微降低移动存储设备性能,禁用后的WTG系统(可能会)支持拔出冻结,就是运行WTG系统拔出后PC不蓝屏,再次插入后会弹出一个警告,告诉你拔出可能会损失数据.之后可以看这里[UASP详细](#jump3)
+ 分卷选项选啥都无所谓
+ UEFI+GPT:支持UEFI模式启动
+ UEFI+MBR:可支持UEFI和传统双启动,有的主板不支持或者没有设置为UEFI,所以如果你想把U盘带到学校机房,最好使用这个模式.
+ VHD选项只有选择`VHD&VHDX`模式才能使用
+ 使用`VHD&VHDX`模式后如果你不手动添加分区会有两个分区一个`efi分区`一个系统分区,可能还会剩余一部分未分配区域,我多次尝试后发现未分配区域不会超过总容量的一半.识别为本地磁盘的设备目前没发现会剩余未分配空间.
+ `虚拟硬盘大小`为0时是自动大小
+ `VHD分区表`默认,或者和前面`常用`选项卡的设置保持一致.
+ `VHD`中转目录通常不用管,只是一个缓冲目录
+ `系统`选项卡我也不太了解,或者说是用不到
+ `修复盘符`可以解决一些启动问题
+ `屏蔽本机硬盘`：在WINDOWS TO GO系统启动后不加载本机硬盘，避免某些还原软件出错.注意：如果本机系统版本低于优盘系统版本，则不能使用此选项.
+ `无默认盘符`：每次优盘插入后，不会自动分配盘符
+ `分区选项卡`我的U盘不能分区,移动硬盘可以分区,原因未知,分区后系统图会自动装入第一个容量不为0的分区
+ `EFI分区大小`默认350m即可.
+ `磁盘`选项卡我不做介绍,如果移动存储设备性能不够好保持默认就好,如果读写速度够快可以勾选`不中转VHD`,前提是你使用的VHD&VHDX模式.



# <span id="jump2">其他注意与建议(必读)</span>

1. wtg要放在纯英文目录下
1. 如果制作失败(闪退报错),可以再大力点鼠标键盘再试一次
2. 如果要使用其他系统镜像,最好使用企业版,会避免很多问题.
3. 不建议在虚拟机中写入,我使用VM,WTG系统出现了几次玄学闪黑
4. 安装后WTG系统请使用本地(域)账户,否者你的WTG系统更换PC机器后会出问题
5. 有些软件通过机器mac地址与账户绑定,登录会出错,所以更换机器后可能需要重新登录
6. 第一次WTG开机后注意将自动更新关闭,或者修改注册表[开启更新](#jump5),否则可能导致无限重启.


# <span id="jump06">统一环境</span>
*这里列出我的环境,为了避免遇到其他的坑,如果你的环境和这个一样,也许会和我遇到同样的问题,下面的步骤会尽量避开我遇到过的问题*
**如果你是一个小白而且不想看前面的必读只是想体验下WTG,那么和我的环境保持一致,然后严格按照我的操作步骤就好**

+ intel cpu,amd我没有机器做测试.
+ 没有安装NVIDA显卡驱动
+ WTG辅助工具:https://bbs.luobotou.org/thread-761-1-1.html 我使用的`4.8.2.0`版本
+ ~~win10 1703镜像:https://bbs.luobotou.org/forum.php?mod=viewthread&tid=17755&fromuid=1~~
+ 使用win10 1803 镜像,可在[I Tell You](https://msdn.itellyou.cn/)找到原版镜像.
+ 你可能会用到分区精灵,这个是[我使用的某版本](https://pan.baidu.com/s/1opLjAVMOdhYz1JUpbz2S7A) 提取码`vczc`,免费版已经完全够用不建议使用破解版,有机会还请支持这种良心软件.
+ 使用WIN10x64 1809企业版系统写入
+ 不建议在虚拟机中写入

# 开始制作

**请确保你已经阅读完 [需要知道的WTG辅助工具高级选项](#jump1) 和 [其他注意](#jump2) **
**不保证操作的安全性,有可能损坏硬盘,且已知有人使用WTG系统烧坏主板,请明确风险,制作的WTG中造成的任何损失与本文作者无关.**
之后的制作过程只讲述怎么操作,你可以和我的设置一样也可以自己按照需求制作,经过n次反复重装我认为这是最适合我的的配置,阅读完上面的必读你应该能够自己按需要设置.
**如果你是一个小白而且不想看前面的必读只是想体验下WTG,那么和我的环境保持一致,然后严格按照我的操作步骤就好**

## 使用U盘制作
### 问题与使用描述
设备识别为`可移动磁盘`所以只能使用`VHD&VHDX`模式,且由于是U盘,磁盘分区后不能给剩余空间的分区分配盘符,多余的空间就无法利用,所以我们通常会想把法让WTG系统占用全部的空间.或者使用量产工具让U盘识别成`本地磁盘`(自行百度),不幸的是我的闪迪没有量产工具.

![什么磁盘](https://e1sewhere.github.io/images/什么磁盘.png)

实际上使用WTG辅助工具制作的时候,总会剩余很大一部分未分配空间.使用不同模式`GTP`或者`MBR`都会剩余只是剩余空间不同,`GTP`会剩余的比较少大概5GB内,`MBR`会剩余一半空间.
且这部分空间我按照教程使用`DiskGenius`合并到系统分区时会报错错误log为`文件分配表中有标记为已使用的未用簇`百度上的处理办法使用了几个都未解决
之后手动删除分区合并再克隆分区,导致系统启动蓝屏,理论上这个思路是对的,但是之后没有耐心研究哪里出问题,遂放弃.
我最开始使用`UEFI+GTP`选项制作,因为这个选项剩余未分配空间少,大约3g,但是不支持传统启动,拿去实验室机房,那个方正主板,直接开机开了4个小时还在黑屏.
后来就使用的`UEFI+MBR`,实验室方正电脑就能用,但是直接29G的未分配空间我不能利用,简直浪费,目前还没找到解决办法(这个应该是这辅助工具的bug看N大啥时候解决?)
根据`WTG辅助工具`的说明使用`传统`写入模式才会出现软件无法安装的问题,但是我用下面的步骤(VHDX)制作完成后也会有一部分软件不能使用,不知道是不是自己硬件问题还是操作问题,错误log多与`windows installer`有关.
不过主流软件都是可以使用的,qq,网易云,chrome啥的,一颗利普斯也能安装.lol能够运行,

office 2016不能安装用wps代替,还有一些我自己常使用的小工具软件.有的软件无法自启会报注册表错误,只能把需要开机启动的软件写个脚本,开机了手动执行下.
cmd有概率无法打开,power shell 没有这个问题.
学校的usb2.0使用我的cz73,依然能够使用Chrome开几个标签,同时打开QQ,S酸R,百度云.使用时没有明显卡顿,但是打开软件时会卡很久,系统内通过软件传输数据可以达到5m/s,我的U盘写入上限是20m/s,学校网速上限也是20m/s.在自己的3.0pc上就完全不卡了.
总之如果你没有重度需求,日用处理资料是够了.

吐槽下学校方正电脑,系统还原卡居然用弱密码口令,手动输了大概5个密码就打开管理员权限了,装个win10配置好,美滋滋,WTG系统什么的都不需要了,以后每次去都用同一台电脑.昨天一个漂亮妹子坐在那里,但是我很气愤,以"这个是我上午用的座位"把她赶跑了,这么好的位置让她用岂不是浪费!

### <span id="jump0">操作步骤 </span>
未说明的选项请保持默认

1. 装载镜像,使用虚拟光驱软件,在win10下可以直接双击装载.
2. 打开wtg辅助工具在`浏览`的选框中选择装载镜像内的 `sources/install.vim`
3. `性能测试`前的选框,选择需要写入的移动设备
4. `常用`:选择`VHDX`,分卷默认,勾选`UEFI+MBR`,勾选`禁用UASP`(这里也可以不选)
5. 勾选`固定大小`
5. `VHD`:`虚拟硬盘大小`0gb,这个看U盘实际情况,后续如果不够还可以[修改容量](#jump4)
6. 系统选择`屏蔽本机硬盘`,不屏蔽有概率破坏本机文件系统,勾选`修复盘符`
7. 点击创建,就开始制作了!
8. 等待创建完成
8. 最后的成功提示和设置如下图

![高级设置1](https://e1sewhere.github.io/images/高级设置1.png)

![高级设置2](https://e1sewhere.github.io/images/高级设置2.png)

![高级设置3](https://e1sewhere.github.io/images/高级设置3.png)

![高级设置4](https://e1sewhere.github.io/images/高级设置4.png)

![高级设置5](https://e1sewhere.github.io/images/高级设置5.png)

![成功窗口](https://e1sewhere.github.io/images/成功窗口.png)

创建完成后里BIOS调整你的移动设备最前,就启动了,如果不会可以参考这个帖子:https://bbs.luobotou.org/forum.php?mod=viewthread&tid=804&fromuid=1
其实百度更好,这帖子图好伤眼睛.
启动后和一般win系统使用没有差别,因为是新系统所以需要初始设置后面的章节会详细介绍.

## 使用移动硬盘制作
东芝 2t usb3.0
### 问题与使用描述
目前只是安装好了还没长时间测试使用效果,明显感觉移动硬盘启动速度快于U盘.没有剩余空间(即使有也可以合并到系统分区,或者自己给他分配盘符当存储使用),而且如果对便携性没有太大要求使用移动硬盘体验好很多,长时间使用没那么容易掉速,毕竟有大缓存,当然你也可以使用WTG土豪专用U盘.

### 操作步骤
和U盘制作步骤一样

1. 装载镜像,使用虚拟光驱软件,在win10下可以直接双击装载.
2. 打开wtg辅助工具在`浏览`的选框中选择装载镜像内的 `sources/install.vim`
3. `性能测试`前的选框,选择需要写入的移动设备
4. `常用`:选择`VHDX`,分卷默认,勾选`UEFI+MBR`,勾选`禁用UASP`
5. 勾选`固定大小`
5. `VHD`:`虚拟硬盘大小`0gb,这个看U盘实际情况,后续如果不够还可以[修改容量](#jump4)
6. EFI分区大小默认,分区一`407726`,分区二`1500000`,分区三`0`.分区一占了1/4,是系统盘,分区二是存储资料的区占3/4,不包含在WTG内,WTG依然可以使用它安装软件,交换数据.
6. 系统选择`屏蔽本机硬盘`,不屏蔽可能主机原本的文件系统,勾选`修复盘符`
7. 勾选`不中转VHD`,可以更快速创建.
7. 点击创建,就开始制作了!
8. 等待创建完成

创建完成后里BIOS调整你的移动设备最前,就启动了,如果不会可以参考这个帖子:https://bbs.luobotou.org/forum.php?mod=viewthread&tid=804&fromuid=1
其实百度更好,这帖子图好伤眼睛.
启动后和一般win系统使用没有差别,因为是新系统所以需要初始设置后面的章节会详细介绍.

# 基础优化与后期设置
软妹魔方地址:http://mofang.ruanmei.com/
这软件现在有点流氓,下载绿色版吧.有广告没啥,篡改主页真的烦人,特别是我这种啥安全软件都没装的人.

## 关闭不必要的服务项 
以下服务都可以关闭:

> Windows search
> Windows Error Reporting Service
> Background Intelligent Transfer Service
> HomeGroup Listener
> HomeGroup Provider
> windows update
> Windows Event Log
> Superfetch
> Windows Defender Service
> Security Center
> Shell Hardware Detection

## 关闭系统休眠
系统休眠会在WTG系统中发生一些问题

1. WTG系统下用系统管理员打开cmd
2. 输入`powercfg -h off`
3. 打开`控制面板`->`控制面板\所有控制面板项\电源选项\编辑计划设置``关闭显示器`和`进入休眠状态`都设为`永不`

## 关闭磁盘整理
自动磁盘整理会拖慢系统速度,而且如果是非机械硬盘磁盘整理只能消耗磁盘寿命.如果需要整理手动就好

1. 对着需要关闭的磁盘右键属性
2. `工具`->`优化`->`关闭`自动优化

## 关闭系统视觉效果
降低性能消耗

1. `此电脑`右键属性->高级系统设置->高级->`性能`groupbox->设置->视觉效果->调整为最佳性能
2. 确定



## 使用内存虚拟硬盘
使用软妹魔方内存盘将系统临时文件放进去,如果你内存够大也可以把其他软件的临时缓存放进去,这样工作量就太大了,这里只事例一个系统临时文件,其他软件同理.

1. 进入WTG系统
1. 打开魔方内存盘(ramdisk)点击`创建内存`,内存盘大小根据自己内存大小决定由于我要在学校机房使用,所以我只设置了250m
2. 勾选开机启动加载此内存盘,关机保存看自己,我选择不保存.确定
3. 打开魔方设置大师(winmaster)->`系统文件夹设置`
4. 取消勾选`只显示推荐修改的项目`
5. 修改`临时文件夹`的`目标路径`为`Z:\TEMP`,这里的`z`为你创建的内存盘的盘符
6. 修改`当前用户临时文件夹`的`目标路径`为`Z:\Temp`
7. 修改`IE的Cookies`的`目标路径`为`Z:\ieCookies`
8. 点击开始转移
9. 设置完成

![内存盘1](https://e1sewhere.github.io/images/内存盘1.jpg)

![内存盘2.jpg](https://e1sewhere.github.io/images/内存盘2.jpg)

## <span id="jump5">系统更新</span>

WTG系统是不能自动更新的,可以用如下步骤实现自动更新

1. 进入WTG系统
2. `win+r`输入`regedit`,回车
3. 修改注册表,定位到` \HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\PortableOperatingSystem`记住现在的数值(我的数值为1),然后将值改为0(16进制).
4. 这样就可以正常更新系统了,更新完成后一定要记得改原来的值.



## <span id="jump3">无UASP实现拔出冻结</span>

拔出冻结功能很有意思,我可以拔出U盘然后去吃饭不用担心别人动我的电脑,应为他操作不了.回来插上就可以继续使用,是不是很炫酷.好吧我承认没什么卵用,但是`我可以不用但不能没有`.
其实还是可以防止不小心碰到U盘让系统崩溃.
而且老主机如果不禁用UASP系统容易崩溃(说的就是你方正电脑),所以我个人是建议禁用UASP的.牺牲点速度换取与稳定与安全.

前人测试,要想支持拔出冻结有下面几个条件,但有人反馈支持uasp的设备不禁用uasp也可以实现拔出冻结.
> 移动存储设备在资源管理器中识别为`本地磁盘`,U盘可使用量产工具实现
> 有些主机为USB 2.0接口(说的就是你方正主板)似乎也不能支持,所以两端都为USB3.0更好
> 不能支持UASP,如果你的设备支持那么就要禁用.


制作时勾选`禁用UASP`,成功制作WTG并运行后桌面上将会出现`DisableUASPHost.exe`，运行它后重启即可禁用UASP.

![拔出冻结](https://e1sewhere.github.io/images/拔出冻结.jpg)

## 更改VHD虚拟硬盘容量

### 介绍
`虚拟硬盘大小`选项可以自己设置虚拟硬盘大小,之后系统使用中也可以修改(不会重装系统损失文件)
下面介绍设置为`0`的情况,为`0`代表自动大小.(前提是你没有勾选`固定大小
`)
如果自动分配了20g,你的系统使用了10g在WTG系统中看你就有10g剩余空间(不包含空闲空间和你自己没有给wtg系统的分区),但是这个移动磁盘插在电脑上直接看容量就使用了20g,当你把剩余10g空间使用完,虚拟硬盘就会自动扩充(如果你物理磁盘分区还有可用空间的话).

假设你的U盘只有两个物理分区,一个系统分区,一个efi分区,那么在`VHD&VHDX`模式制作下进入WTG系统你就可以在资源管理中看到两个盘,一个C盘是系统盘,一个D盘几乎被占满.

如果你给U盘三个物理分区,一个系统分区,一个efi,一个自己存储文件的分区,并且没有勾选`无默认盘符`,那么进入WTG后就有三个分区,多一个你自己存储文件的分区,这个分区可以用于WTG系统和主机系统交换文件,且即使占满也不会影响WTG系统.

### <span id="jump4">更改容量</span>
如果我们新建的VHD磁盘容量不够了，或者VHD磁盘占用了优盘较多空间，可以使用如下方法调整,不会损失文件.
**已经差分的VHD不能随意调整容量，需要先合并VHD或删掉子VHD！**
**在本机系统中操作不能再WTG系统中操作**
使用`bootice`,在WTG辅助工具的,`工具`中,我的BOOTICE版本为`1.3.4`

![BOOTICE](https://e1sewhere.github.io/images/BOOTICE.png)

1. 打开本机系统后,插上WTG的U盘
2. `物理磁盘`->`目标磁盘`选择WTG的磁盘
1. `磁盘镜像`->`镜像文件`选择你的WTG系统分区里的`wtg.vhdx`,类似的文件,如果你是按照我的步骤做的,应该是这个文件名.
2. 点击`VHD文件信息`,选择`重设容量`,设置一个比你需要的容量,注意单位,最好扩大,缩小可能导致数据丢失,且win8以上的系统才支持缩小.
3. 点击`设定,可能会等很久,取决于你修改的大小和系统配置.
4. 修改完成后**进入WTG系统**,对`此电脑`右键,`管理`->`存储`->`磁盘管理`
5. 对你安装WTG系统的磁盘的,系统分区(通常c盘)右键`扩展卷`
6. 下一步->下一步->完成

![扩展卷](https://e1sewhere.github.io/images/扩展卷.png)

![镜像文件](https://e1sewhere.github.io/images/镜像文件.png)

![重设容量](https://e1sewhere.github.io/images/重设容量.png)

## 备份与恢复系统
备份的方法有很多,GHOST,Dism的wim,还有直接备份VHD文件
Dism可以直接用Dism++制作备份文件,还原时直接用ＷＴＧ辅助工具按照同制作WTG的方法一样,制作就好.
GHOST不介绍了
这里讲VHD文件备份,只适用于VHD&VHDX模式.

### 备份

1. 将移动磁盘内的`xx.vhd`或者`xx.vhdx`文件复制到需要备份的位置
2. 备份完成

是不是炒鸡简单

### 还原

1. 打开WTG辅助工具选择还原的移动磁盘
2. 选择`xx.vhd`&`xx.vhdx`文件为安装镜像(需要更改筛选为所有文件).
3. 右侧参数和你制作系统是保持一致
4. 点击制作

# 关于这个介绍帖子的提问

Q:WTG需要手动安装驱动么?
A:*不需要,win10会自动打上必要的驱动,如果你要玩游戏或者做图形编辑需要手动装显卡驱动.*

Q:为什么不用官方工具?
A:*用不了,官方工具有U盘限制,买不起那种U盘.*

Q:安装WTG后可以同时装PE么?
A:*可以,参看[U盘安装win+ubuntu+winpe教程](https://bbs.luobotou.org/thread-43681-1-1.html).*

Q:可以用安卓手机制作WTG系统么?
A:*可以但你只能用安卓手机当存储设备,写入还是得用win,使用辅助工具可以在大多数存储设备上制作WTG系统,所以你在用来换盆的手机上做也可以,有老哥成功过,不过肯定会卡的怀疑人生.*

Q:WTG系统可以更新么?
A:*可以,查看[系统更新](#jump5).*

Q:WTG用起来卡么?
A:*我可以用移动硬盘做的系统打 无主之地,这取决于你机器的性能和U盘的读写能力.*

Q:哪些U盘可以适合做WTG系统
A:*参看[适合WTG的USB闪存盘大排名](https://bbs.luobotou.org/thread-10680-1-1.html).*

Q:WTG写入U盘很久都没完成怎么办?
A:*等待,如果超过一个小时还没完成,尝试删除所有分区格式化后再使用WTG辅助工具写入,如果还是不行,很可能是你的U盘不适合做WTG系统*

Q:WTG系统很久都没有启动
A:*等待,确实需要启动很久,如果出现了微软的flag标识应该就是能够成功启动的,超过30分钟没成功就要考虑重启,或者重新制作了.*

# 其他你可能需要的链接
这里列出我省略的一些操作,我上文写的内容都是我自己测试过没有问题的,下面这些多是我测试后没有成功,或者没有什么效果的还有一些其他的科普向链接.如果你想尝试可以从下面快速导视,我将论坛主要的帖子列了出来,方便自己以后查看.

+ [ Windows To Go 制作帮助（FAQ、常见故障)](https://bbs.luobotou.org/thread-1625-1-1.html)
+ [禁用UASP 实现"拔出冻结"功能](https://bbs.luobotou.org/forum.php?mod=viewthread&tid=12453)
+ [使用WTGA部署WTG工作区后剩余未分配空间的解决方法](https://bbs.luobotou.org/forum.php?mod=viewthread&tid=16248&extra=page%3D1%26filter%3Dtypeid%26typeid%3D161) **此方法已经有多人会遇到`产生文件分配表中有标记为已使用的未用簇`**
+ [未分配空间的另一种解决方法](https://bbs.luobotou.org/forum.php?mod=viewthread&tid=31670&page=1&extra=#pid77322)
+ [WTG辅助工具高级选项说明](https://bbs.luobotou.org/forum.php?mod=viewthread&tid=6098)
+ [Windows To Go 系统备份还原](https://bbs.luobotou.org/forum.php?mod=viewthread&tid=12415&extra=page%3D1%26filter%3Dtypeid%26typeid%3D161)
+ [EWF与FBWF相关教程](https://bbs.luobotou.org/thread-6587-1-1.html) EWF能够提速,我没有使用
